!function(){"use strict";angular.module("app",["app.controllers","app.services","ui.router","firebase"]).run(["$rootScope","$state","AuthService","MapService",function(e,t,o,r){e.$on("$routeChangeError",function(e,o,r,i){"AUTH_REQUIRED"===i&&t.path("login")}),r.currentLocation(),o.state()}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"templates/home.html"}).state("dashboard",{url:"/dashboard",views:{"":{templateUrl:"templates/dashboard.html",controller:"DashboardCtrl",resolve:{currentAuth:["Auth",function(e){return e.$requireAuth()}]}}}}),t.otherwise("/home")}])}(),function(){"use strict";angular.module("app.controllers",[]).controller("HomeCtrl",["$scope","AuthService",function(e,t){e.login=function(){t.login()}}]).controller("DashboardCtrl",["$scope","MapService","currentAuth","Auth","DataService","$rootScope",function(e,t,o,r,i,n){t.initialize(),e.initSearch=function(e,r){n.markers.length>0&&(n.markers.forEach(function(e){e.setMap(null)}),n.markers=[]),t.search(e).then(function(n,a){t.initMarkers(n),r&&i.saveSearch(e,o.uid)})},e.logout=function(){r.$unauth()},e.queries=i.getQueries(o.uid)}])}(),function(){"use strict";angular.module("app.services",[]).constant("FirebaseUrl","https://googleplaces.firebaseio.com/").service("FireDB",["FirebaseUrl",function(e){var t=new Firebase(e);return t}]).service("Auth",["$firebaseAuth","FirebaseUrl",function(e,t){var o=new Firebase(t);return e(o)}]).service("AuthService",["FireDB","Auth","$state",function(e,t,o){function r(e){return"google"==e.provider?e.google.displayName:void 0}this.login=function(){t.$authWithOAuthPopup("google").then(function(e){})["catch"](function(e){console.error("Authentication failed:",e)})},this.state=function(){return t.$onAuth(function(t){if(t){var i=e.child("Users").child(t.uid);i.once("value",function(e){var n=r(t);null===e.val()?i.set({Provider:t.provider,Name:n,Date:Firebase.ServerValue.TIMESTAMP}):i.update({Name:n}),o.go("dashboard")})}else o.go("home")})}}]).service("MapService",["FirebaseUrl","$rootScope","$q",function(e,t,o){this.initialize=function(){this.map=new google.maps.Map(document.getElementById("map"),{zoom:5});this.checkLocation();this.service=new google.maps.places.PlacesService(this.map),t.markers=[],t.infoWindow=new google.maps.InfoWindow},this.checkLocation=function(){if(t.location)return this.map.setCenter(t.location),this.map.setZoom(12),t.location;var e={lat:39.5,lng:-98.35};return this.map.setCenter(e),e},this.search=function(e){var t=o.defer(),r=this.checkLocation(),i={location:r,radius:"500",query:e};return this.service.textSearch(i,function(e,o){"OK"==o?t.resolve(e):t.reject(o)}),t.promise},this.initMarkers=function(e){for(var t=this.map,o=0;o<e.length;o++)this.setMarker(e[o],t)},this.setMarker=function(e,o){var r={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},i=new google.maps.Marker({map:o,icon:r,title:e.name,position:e.geometry.location});t.markers.push(i),google.maps.event.addListener(i,"click",function(){var r;r=e.opening_hours?e.opening_hours.open_now===!0?"Open now":"Currently closed":"";var i="<div class='markerWindow'><p class='title'>"+e.name+" &nbsp; <a target='_blank'' href='https://www.google.com/maps/dir/"+t.location.lat+","+t.location.lng+"/"+e.formatted_address+"' class='link-btn btn-sm btn-primary'>Directions</a></p><p>Address : "+e.formatted_address+"</p><p>"+r+"</p></div>";t.infoWindow.setContent(i),t.infoWindow.open(o,this)}),google.maps.event.addListener(o,"click",function(){t.infoWindow.close()})},this.currentLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o={lat:e.coords.latitude,lng:e.coords.longitude};t.location=o},this.geoLocationError):alert("Your browser does not support geolocation")},this.geoLocationError=function(e){switch(e.code){case e.PERMISSION_DENIED:alert("Please allow location tracking for better results");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred.")}}}]).service("DataService",["FireDB","$firebaseArray",function(e,t){this.saveSearch=function(t,o){var r=e.child("SearchQueries").child(o);r.push({query:t,time:Firebase.ServerValue.TIMESTAMP})},this.getQueries=function(o){var r=t(e.child("SearchQueries").child(o));return r}}])}();